require.config({baseUrl:"js/lib",paths:{jquery:"jquery.min",zepto:"zepto","zepto-custom":"zepto-custom",async:"async.min",los:"localStorage",underscore:"underscore.min",backbone:"backbone",focus:"../entry/modules/input-focus",deferred:"deferred",touch:"touch",event:"event",callbacks:"callbacks",utils:"../entry/modules/utils",textFormat:"../entry/modules/textFormat"},map:{"*":{zepto:"zepto-custom"},"zepto-custom":{zepto:"zepto"}},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","zepto"],exports:"Backbone"},zepto:{exports:"$"},deferred:{exports:"$",deps:["zepto"]},event:{exports:"$",deps:["zepto"]},touch:{exports:"$",deps:["zepto"]},callbacks:{exports:"$",deps:["zepto"]}}}),require(["underscore","zepto","backbone","async","focus","event","deferred","callbacks","touch","utils","textFormat"],function(t,e,n,o){function r(t){var n=e("<pre>"+t+"</pre>").css({display:"inline"});e("body").append(n);var i=n.width();return n.remove(),i}Pathurl={getTyrant:"/getTyrant"};var s=n.Model.extend({"default":{name:"",tyrant:[]},detechOver:function(t){var e=!1;return this.tyrant.forEach(function(n,i){return n.name===t.name?void(e=!1):void(e=!0)}),e},setName:function(t){this.set({name:t})},getTyrant:function(){return this.get("tyrant")},addTyrant:function(t){var e=this.get("tyrant"),n=e.length,i={name:t.name,title:t.title,scripts:t.scripts,src:t.src};4===n&&e.shift(),e.push(i)},parseScript:function(t,e){e=e.replace("<name>",this.name);var n={name:t,script:e};this.detechOver()&&this.tyrant.push(n)}}),a=n.View.extend({el:e(".i-index"),info:e(".i-index #i-prompt"),confirm_btn:e("#i-confirm-btn"),events:{"keyup #i-testname":"limitLength","tap #i-confirm-btn":"jumpTo"},render:function(){var t=this;this.$el.show(),e("body").addClass("i-index-show"),this.$el.find(".i-testname").inputFocus("输入测试姓名"),setTimeout(function(){t.setAnimation()},10)},promptShow:function(){this.info.text("您输入的字符过长,请重新输入~")},promptHide:function(){this.info.text("")},hide:function(){this.$el.hide()},limitLength:function(t){var e=this.$el.find("#i-testname").val(),n=r(e),i=this;return"输入测试姓名"===e?(i.info.text("姓名不能为空~"),!1):n>61?(i.promptShow(),!1):(i.promptHide(),x.setName(e),!0)},setAnimation:function(){var t=this.$el.find(".logo-mayun,.logo-liuQD,.logo-liJC,.logo-Bill,.logo-wangSC,.i-words,.words-right,.words-left,.words-rich,.logo-building1,.logo-building2,.logo-building3");t.addClass("now"),setTimeout(function(){e("body").addClass("now")},2e3)},isValidate:function(t){return t},jumpTo:function(){this.limitLength()&&f.navigate("/test",{trigger:!0,replace:!0})}}),d=n.View.extend({el:e(".l-loading"),decade:e(".l-loading #l-decade"),bit:e(".l-loading #l-bits"),initialize:function(){this.render()},hide:function(){this.$el.hide()},render:function(){var t=["img/index/confirm.png","img/author.png","img/coin.png","img/index/thigh.png","img/test/test-s4cdb85fdf3.png","img/index/logo/mayun.png","img/index/logo/liuQD.png","img/index/logo/liJC.png","img/index/logo/Bill.png","img/index/logo/wangSC.png","img/index/logo/building1.png","img/index/logo/building2.png","img/index/logo/building3.png","img/index/confirm.png","img/index/thigh.png","img/index/logo/title.png","img/test/others.png","img/test/follow.png"];this.preload(t)},setNum:function(t){var e,n,t=Math.floor(t),i=this;100===t?e=n=9:(e=t%10,n=Math.floor(t/10)),i.bit.removeClass().addClass("num-"+e),setTimeout(function(){i.decade.removeClass().addClass("num-"+n)},200)},preload:function(t){var n=t.length,r=0,s=new Array,a=this;for(i=0;i<n;i++)s[i]=new Image,s[i].onload=function(){r++,o.series([function(t){if(n>=r){var i=100*Number(r/n).toFixed(4);e(".l-cover").width(i+"%"),a.setNum(i)}t()}],function(){r===n&&setTimeout(function(){a.hide(),g.render(),a.isFinish(!0)},1e3)})},s[i].src=t[i]},isFinish:function(t){return null===t||""==t?!1:t}}),l=n.View.extend({el:e("#t-test"),figure:e("#t-figure"),name:e("#t-name"),title:e("#t-title"),scripts:e("#t-scripts"),trans:e(".t-transition,#test-first,#test-second,#t-message,.t-layer"),music:e("#loading"),events:{"tap #t-again-btn":"testAgain","tap #t-produce-btn":"obtainResult"},render:function(){var t=x.get("name");this.name.text(t),this.sendAjax(),this.$el.show()},changeInfo:function(t){this.title.text(t.title),this.scripts.text(t.scripts);var e=t.src.replace(".png","1.png");this.figure.attr("src",e),x.addTyrant(t)},ajax:function(t,e){sendAjax(t,e)},sendAjax:function(){var t=this,e=x.get("name"),n=r(e),i=x.getTyrant(),o=i.map(function(t){return t.name}),s=Pathurl.getTyrant+"?name="+e+"&len="+n;t.ajax(s,{method:"post",data:{name:o},contentType:"application/json",success:function(e){t.changeInfo(JSON.parse(e))},error:function(t){var e=confirm("网络问题~~需要刷新吗?");e&&(window.location.href="/")}})},hide:function(){this.$el.hide()},showTran:function(){this.trans.addClass("now")},hideTran:function(){this.trans.removeClass("now")},testAgain:function(){var t=this,e=t.music[0];t.showTran(),t.sendAjax(),document.createElement("video").canPlayType&&(4==e.readyState?e.play():(e.addEventListener("canplaythrough",function(){},!1),e.load(),e.play())),setTimeout(function(){t.hideTran()},3e3)},obtainResult:function(){f.navigate("/result",{trigger:!0,replace:!0})}}),c=n.View.extend({el:e(".r-result"),first:e(".r-first,g.r-first"),first_text:e(".r-first-text").find("span"),first_img:e(".r-first").find(".figure"),second:e(".r-second,g.r-second"),second_text:e(".r-second-text").find("span"),second_img:e(".r-second").find(".figure"),third:e(".r-third,g.r-third"),third_text:e(".r-third-text").find("span"),third_img:e(".r-third").find(".figure"),fourth:e(".r-fourth,g.r-fourth"),fourth_text:e(".r-fourth-text").find("span"),fourth_img:e(".r-fourth").find(".figure"),result_name:e("#r-name"),events:{"tap #r-again-btn":"backIndex"},render:function(){this.$el.show(),this.fillName(),this.showTyrant()},backIndex:function(){window.location.href="/"},shuffle:function(t){for(var e,n,i=t.length;i;)n=Math.floor(Math.random()*i--),e=t[i],t[i]=t[n],t[n]=e;return t},fillName:function(){this.result_name.text(x.get("name"))},showTyrant:function(){var t=this.shuffle(x.getTyrant()),e=this,n=t.length;switch(n){case 1:e.fillInfo(t[0],1);break;case 2:e.fillInfo(t[0],1),e.fillInfo(t[1],4);break;case 3:e.fillInfo(t[0],1),e.fillInfo(t[1],4),e.fillInfo(t[2],3);break;case 4:e.fillInfo(t[0],1),e.fillInfo(t[1],4),e.fillInfo(t[2],3),e.fillInfo(t[3],2)}},fillInfo:function(t,e){var n,i,o,r=this;switch(e){case 1:n=r.first_text,i=r.first_img,o=r.first;break;case 2:n=r.second_text,i=r.second_img,o=r.second;break;case 3:n=r.third_text,i=r.third_img,o=r.third;break;case 4:n=r.fourth_text,i=r.fourth_img,o=r.fourth}console.info(t.scripts+e),console.log(new textFormat(t.scripts,e).content),n.html(new textFormat(t.scripts,e).content),i.attr("src",t.src),setTimeout(function(){o.each(function(){this.classList.add("now")})},1e3)},hide:function(){this.$el.hide()}}),u=n.Router.extend({routes:{"":"loading",test:"test",result:"obtainResult"},loading:function(){h.isFinish()?(h.hide(),g.render()):h.render()},test:function(){m.render(),g.hide()},obtainResult:function(){p.render(),m.hide()}}),f=new u,h=new d,g=new a,m=new l,p=new c,x=new s({tyrant:[],name:""});n.history.start({pushState:!0})});